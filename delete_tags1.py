"""
author: Yong_z
删除指定tags,可多个
"""
import time
import os
from github import Github, GithubException

# heyong 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
# XIII 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
# 你的 Github Personal Access Token
access_token = "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"


def traverse_directory(directory):
    file_list = []
    for filename in os.listdir(directory):
        path = os.path.join(directory, filename)
        if os.path.isdir(path):
            file_list += traverse_directory(path)
        else:
            name, ext = os.path.splitext(filename)
            if len(name) >= 20:
                file_list.append(name)
    return file_list


#file_array = traverse_directory('.')

# 实例化 Github 对象
try:
    g = Github(access_token)
    repo = g.get_user().get_repo('ManifestAutoUpdate')  # 输入 Repo 的名称
except GithubException as e:
    print(f"Github Exception: {e}")
    if e.status == 403:
        # 这里是处理「被禁止访问」的逻辑
        print("API 调用次数限制！休息1小时")
        time.sleep(3600)
else:
    print(f"Connected to Github as {g.get_user().login}")
    # 删除指定的 tags
    appid = '255710'
    tags_to_delete = ["255711_5651841126139139502","255712_5023038568061968416","255713_6025825167241829143","352510_7123489600763198871","352511_5414751412616420673","255720_852385160178766697","255721_1625223192604467070","255722_6633545179875120363","255723_8856600409965711738","255724_9049674155703089828","255725_1466405059764001106","944072_3712078253560121570","944073_289915600672015817","944074_7722967552608028136","1065492_7466621565301344156","1065493_2381763253807829369","1065494_5004619621585266912","1065495_8050933269028306268","1065496_977353470357514182","1065497_429213752068640145","1148023_1922603953388439803","1148024_5250545151175553704","1148025_8763813454172900471","1196101_1533764397998152295","1196102_252638573530759748","1196103_8513732796251257640","815381_8853720379753105222","815382_5377846149254053641","815383_8287929360916114055","255726_7459269725805026117","255727_1570965744844427562","255728_2844814335444210186","255717_457366953280935037","255718_1681679388249594316","255719_1293376866617077330","255714_1134142675767592641","255715_5730005230499338630","255716_3369737925930638570","1531474_5572428835740911639","1531475_8768455533806446348","1531476_8463337664244095814","1531477_7467492160282037449","1531478_2785578080942865062","1531479_8201500015210171955","340161_5520484552045864175","340162_3206627690239484311","340163_4848260941466591819","340164_6466629528687169258","340165_2872744250934900778","340166_4673355229412027265","2008401_1998533869551272137","2008402_1567045058205849095","2008403_9154534354189384600","2008404_86736102625976399","2008405_2932537948125357453","2008406_3361079888336932391","2144485_8513252047756060296","2144486_2469817934690770627","2144487_4680798037346379050","2148907_8120470507175934519","2148908_7783001386352587933","2148909_6630697275597168439","2202577_4144655263445449597","2202578_6208940419707708490","2202579_3641560502914519644","2225947_3619214019239292892","2225948_3416241063231335401","2225949_638136854516622778"] 
     # 输入要删除的 tags
    #tags_to_delete = file_array
    for tag_name in tags_to_delete:
        try:
            tag = repo.get_git_ref(f"tags/{tag_name}")
            tag.delete()
            print(f"Deleted tag: {tag_name}")
        except GithubException as e:
            print(f"Failed to delete tag {tag_name}: {e}")
        try:
            tag2 = repo.get_git_ref(f"tags/{appid}/{tag_name}")
            tag2.delete()
            print(f"Deleted tag: {appid}/{tag_name}")
        except GithubException as e:
            print(f"Failed to delete tag {appid}/{tag_name}: {e}")